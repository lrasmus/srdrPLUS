javascript:
  var updateSectionFlag = function(domEl) {
    var sectionId = domEl.id[0];
    var sd_meta_datum_id = $(domEl).attr('data-sd_meta_datum_id');
    var status = domEl.checked;
    var paramKey = `section_flag_${sectionId}`;
    $.post(`${$('#sd-meta-form')[0].action}/section_update`,
      { sd_meta_datum: { [paramKey]: status } },
      function( data ) { check(sectionId, data.status); }
    );
  }

  $('.switch-input').on('click', function() {
    if (this.id[0] != 4) { updateSectionFlag(this); }
  });

  var initializeSwitches = function() {
    if ("#{@sd_meta_datum.section_flag_0}" === 'true') {
      $('#0-yes-no-section')[0].checked = true;
      check(0, true)
    }
    if ("#{@sd_meta_datum.section_flag_1}" === 'true') {
      $('#1-yes-no-section')[0].checked = true;
      check(1, true)
    }
    if ("#{@sd_meta_datum.section_flag_2}" === 'true') {
      $('#2-yes-no-section')[0].checked = true;
      check(2, true)
    }
    if ("#{@sd_meta_datum.section_flag_3}" === 'true') {
      $('#3-yes-no-section')[0].checked = true;
      check(3, true)
    }
    if ("#{@sd_meta_datum.section_flag_4}" === 'true') {
      $('#4-yes-no-section')[0].checked = true;
      check(4, true)
    }
    if ("#{@sd_meta_datum.section_flag_5}" === 'true') {
      $('#5-yes-no-section')[0].checked = true;
      check(5, true)
    }
  };

  $( document ).on("turbolinks:load", function() {
    setTimeout(function(){ initializeSwitches(); }, 500);
  });

  var submit_form = function() {
    var data = $('#sd-meta-form').serialize();

    $.ajax({
      type: "PATCH",
      url: `${$('#sd-meta-form')[0].action}`,
      data: data
    });
  }

  $(document).on('select2:select', 'select.key_question', function (e) {
    submit_form();
  });

  $(document).on('confirm:complete', function (e) {
    if (e.target.getAttribute('data-remove-key-question') === 'true') {
      var removedKeyQuestion = $(`#${e.target.parentElement.children[0].children[1].id} option:selected`).text()
      if (e.detail[0]) {
        $("div").filter(function() {
          if ($(this).hasClass('droppable') && $(this).text() === removedKeyQuestion) {
            this.remove();
            setTimeout(function() { submit_form(); }, 400)
          }
        })
      }
    }
  });

  $(document).on('click', "a[data-association='sd_key_question']", function (e) {
    submit_form();
  })